<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>MACS 30500 LECTURE 4</title>
    <meta charset="utf-8" />
    <meta name="author" content="Topics: Exploratory vs. Confirmatory Data Analysis. Using Graphs for Data Analysis. Factors in R." />
    <script src="index_files/header-attrs/header-attrs.js"></script>
    <link href="index_files/panelset/panelset.css" rel="stylesheet" />
    <script src="index_files/panelset/panelset.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# MACS 30500 LECTURE 4
]
.author[
### Topics: Exploratory vs. Confirmatory Data Analysis. Using Graphs for Data Analysis. Factors in R.
]

---







class: inverse, middle

# Agenda

* Exploratory vs. Confirmatory Data Analysis

* Using Graphs for Data Analysis (practice with the `scorecard` data): 
  * Display variation &amp; co-variation 
  * Match type of plot to variable type!

* Factors in R

&lt;!--
* Overview of Exploratory Data Analysis
* Exploratory VS. Confirmatory Data Analysis
* EDA with the `scorecard` dataset
  * variation &amp; co-variation 
  * match type of plot to variable type
--&gt;

&lt;!--
Main takeaways from today's lecture: 
1. match plot to variable type
1. do not stop after one plot... experiment with different visualizations
1. effective use of visuals for EDA often require data transformation (`dplyr` + `ggplot`)

Goals for this time (summer 2024) were (1) to make this lecture more interactive and (2) to improve the message of matching the plot with the right variable types

There is still room for improvement; idea for next time: start with the intro on what is EDA (me lecturing, but also keep the interactive session on other ways to code that penguins example); then start the section titled "EDA with scorecard dataset" with a slide that lists all "tasks" and ask students to code them first, in team of 2 and give specific instructions: identify the type of variables you need to use, explain which plot is the most suitable to represent that relationship and why (more than one plot might be suitable, pick one); produce the code and put code and plot (copy-paste it?) in this shared document under your "task") 

have students work on it for 10 min then we share insights and compare results; have student share their code on google or something that everyone can see so we can run the plot interactively in class  
might want to increase or vary the difficulty level of tasks and to give an intro to the dataset together before jumping into it
the bulk of the lecture should be this activity

SUGGESTIONS FOR NEXT TIME:

say that this is a key lecture and you want to return to it in future hw, including hte last two (hw6 and final project that are more open ended), mostly we want variety in graphs (bar graphs are great but there are other ways to display two cat variables)

show more type of graphs and give an exercise on that

add the vis cheat sheet

the ggplot2 cheatsheet is great for ideas on different types of graph (click on Download pdf)
https://rstudio.github.io/cheatsheets/html/data-visualization.html?_gl=1*16veqlu*_ga*MjA5MDcxNzYwNC4xNzE1Nzg4MDI2*_ga_2C0WZ1JHG0*MTcyMTMxOTYwNC43LjAuMTcyMTMxOTYwNC4wLjAuMA

--&gt; 

---

class: inverse, middle

# Exploratory vs. Confirmatory Data Analysis

---

### Exploratory vs. Confirmatory Data Analysis


**Exploratory Data Analysis (EDA)**

All set of exploratory investigations to understand your data and generate questions. Goals: discover patterns and insights,  spot anomalies (outliers), generate questions, formulate hypotheses.


**Confirmatory Data Analysis (CDA)**

Also called Explanatory Data Analysis. Generally hypothesis-driven, and comes after EDA, to formally test hypotheses (e.g., modeling)

--

*Today, and in this course, we mostly focus on EDA!*

---

### EDA as Iterative and Creative Process

**EDA is an Iterative Process:**

1. Generate exploratory questions about your data
1. Search for answers in the data
1. Use what you learn to refine your questions and/or generate new questions
1. Repeat until necessary

--

**EDA is a also a Creative Process:**

EDA is not an exact science, and requires curiosity about the data, intuition, and patience. At the most basic level, it involves answering two questions: how values within a single variable vary?
how values of two variables co-vary?

---

### EDA relies on...

**Descriptive stats** such as frequency counts, measures of central tendency (mean, mode, median), and dispersion (range, variance, standard deviation).


**Visualizations** such histograms, bar charts, scatter plots, etc. We focus on visualizations, and specifically we display:
- Variation: how values within a single variable vary (univariate analysis)
- Covariation: how values of two variables co-vary (bivariate analysis)

--

*Visualizations are essential tools in both EDA and CDA, each with distinct purposes. Even within EDA, we can utilize visualizations in multiple ways. Let’s look at an example with the penguins data to illustrate this point.* 

&lt;!--
In Exploratory Analysis you might generate 10, 20 or even 100 graphs, but not all of them will be useful for your research. In Confirmatory Analysis, you generate only a few graphs and each graph is well refined and will be put in your final report or research.
--&gt;

---

### Example: First Plot


```r
library(palmerpenguins)
data("penguins")
head(penguins)
```

```
## # A tibble: 6 × 8
##   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
## 1 Adelie  Torgersen           39.1          18.7               181        3750
## 2 Adelie  Torgersen           39.5          17.4               186        3800
## 3 Adelie  Torgersen           40.3          18                 195        3250
## 4 Adelie  Torgersen           NA            NA                  NA          NA
## 5 Adelie  Torgersen           36.7          19.3               193        3450
## 6 Adelie  Torgersen           39.3          20.6               190        3650
## # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;
```

TASK: build a plot of two continuous variables (penguins body mass and flipper length).

&lt;!-- ASK: if we have two continuous antiquate variables and so we want to show co-variation among them... what is the best plot to use? --&gt;

---



count: false
 
### First Plot
.panel1-penguins-eda-auto[

```r
*ggplot(
* data = penguins,
* mapping = aes(
*   x = body_mass_g,
*   y = flipper_length_mm)
* )
```
]
 
.panel2-penguins-eda-auto[
&lt;img src="index_files/figure-html/penguins-eda_auto_01_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
count: false
 
### First Plot
.panel1-penguins-eda-auto[

```r
ggplot(
  data = penguins,
  mapping = aes(
    x = body_mass_g,
    y = flipper_length_mm)
  ) +
* geom_point()
```
]
 
.panel2-penguins-eda-auto[
&lt;img src="index_files/figure-html/penguins-eda_auto_02_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
count: false
 
### First Plot
.panel1-penguins-eda-auto[

```r
ggplot(
  data = penguins,
  mapping = aes(
    x = body_mass_g,
    y = flipper_length_mm)
  ) +
  geom_point() +
* geom_smooth()
```
]
 
.panel2-penguins-eda-auto[
&lt;img src="index_files/figure-html/penguins-eda_auto_03_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

&lt;style&gt;
.panel1-penguins-eda-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-penguins-eda-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-penguins-eda-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



&lt;!-- notice in the code I put the data and mapping above, right after ggplot() because both geometries use the same data and mapping --&gt;

--

Once you draw such initial plot, ask yourself:

* *Substantive questions:* What does this graph tell us? Are there patterns? Outliers? What hypotheses can we generate from it? Is the chosen plot appropriate here?
* *Stylistic questions:* What are the strengths and limitations of this quick visualization? How could we improve it?

&lt;!--
Pros: minimum code, easy to replicate, good for your internal use
Cons: not well refined, not good for publication or external audience
--&gt;

---



count: false
 
### Refined Plot
.panel1-penguins-final-auto[

```r
*ggplot(
* data = penguins,
* mapping = aes(
*   x = body_mass_g,
*   y = flipper_length_mm)
* )
```
]
 
.panel2-penguins-final-auto[
&lt;img src="index_files/figure-html/penguins-final_auto_01_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
count: false
 
### Refined Plot
.panel1-penguins-final-auto[

```r
ggplot(
  data = penguins,
  mapping = aes(
    x = body_mass_g,
    y = flipper_length_mm)
  ) +
* geom_point(alpha = .1)
```
]
 
.panel2-penguins-final-auto[
&lt;img src="index_files/figure-html/penguins-final_auto_02_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
count: false
 
### Refined Plot
.panel1-penguins-final-auto[

```r
ggplot(
  data = penguins,
  mapping = aes(
    x = body_mass_g,
    y = flipper_length_mm)
  ) +
  geom_point(alpha = .1) +
* geom_smooth(method = "lm",
*             se = FALSE)
```
]
 
.panel2-penguins-final-auto[
&lt;img src="index_files/figure-html/penguins-final_auto_03_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
count: false
 
### Refined Plot
.panel1-penguins-final-auto[

```r
ggplot(
  data = penguins,
  mapping = aes(
    x = body_mass_g,
    y = flipper_length_mm)
  ) +
  geom_point(alpha = .1) +
  geom_smooth(method = "lm",
              se = FALSE) +
* labs(
*   title = "Relationship between body mass and\nflipper length of a penguin",
*   subtitle = "Sample of 344 penguins",
*   x = "Body mass (g)",
*   y = "Flipper length (mm)"
* )
```
]
 
.panel2-penguins-final-auto[
&lt;img src="index_files/figure-html/penguins-final_auto_04_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
count: false
 
### Refined Plot
.panel1-penguins-final-auto[

```r
ggplot(
  data = penguins,
  mapping = aes(
    x = body_mass_g,
    y = flipper_length_mm)
  ) +
  geom_point(alpha = .1) +
  geom_smooth(method = "lm",
              se = FALSE) +
  labs(
    title = "Relationship between body mass and\nflipper length of a penguin",
    subtitle = "Sample of 344 penguins",
    x = "Body mass (g)",
    y = "Flipper length (mm)"
  ) +
* theme_xaringan(
*   title_font_size = 18,
*   text_font_size = 16
* )
```
]
 
.panel2-penguins-final-auto[
&lt;img src="index_files/figure-html/penguins-final_auto_05_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

&lt;style&gt;
.panel1-penguins-final-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-penguins-final-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-penguins-final-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



&lt;!-- notice here geom_point and geom_smooth also have their own arguments that work only for them; 
for example:
if I want to make the points of the scatterplot more faded I use alpha there; 
or here I wanted to use a specific method to draw the regression line vs. let R selecting it automatically, so I specify the method and I also do se = FALSE as the default is true and shows the standard error

labs() and theme_xarigan() control the non-data elements of the plot; lab(): controls things like title, subtitles etc; theme() controls background colors, font size, etc.

Notice there is also a geometry that controls titles etc. and it is called geom_text()
Note the difference between `labs()` and `geom_text()` 
Book "`ggplot2`: Elegant Graphics for Data Analysis" https://ggplot2-book.org/annotations.html

--&gt;



---

## Takeaway

In this course, our focus is primarily on Exploratory Data Analysis (EDA); we won’t delve into Confirmatory Data Analysis or formal hypothesis testing.

**Still, your approach to plotting should follow this sequence:**

* Begin by creating several quick plots to explore the data: 
  * Pros: save coding time and focus on observing the data. 
  * Avoid adjusting stylistic components at this stage; instead, refine by removing outliers, changing graph types, or adding variables until you’re satisfied with the plot.

* Once you have settled on a plot:
  * Improve its visual appeal by refining the code. Add elements such as labels, legends, color adjustments, scales, themes, facets, etc. 
  * Use this polished version for reports, presentations, and your final plots for the assignments in this course!

&lt;!-- you should approach HW2 with this slide in mind! --&gt;

---

class: inverse, middle

# Using Graphs for Data Analysis 

#### We use the `scorecard` data to practice using graphs for data analysis, and specifically: 
  
  * Display variation &amp; co-variation 
  * Match type of plot to variable type!
  
---

### The `scorecard` dataset


```r
library(tidyverse)
library(rcis)
data("scorecard")
```

The Department of Education collects annual statistics on colleges and universities in the United States. Data include: universities names, state, type, admission rate, costs, etc. 

We are going to look at a subset of this data, from 2018-19.

---

### The `scorecard` dataset


```r
glimpse(scorecard)
```

```
## Rows: 1,732
## Columns: 14
## $ unitid    &lt;dbl&gt; 100654, 100663, 100706, 100724, 100751, 100830, 100858, 1009…
## $ name      &lt;chr&gt; "Alabama A &amp; M University", "University of Alabama at Birmin…
## $ state     &lt;chr&gt; "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", …
## $ type      &lt;fct&gt; "Public", "Public", "Public", "Public", "Public", "Public", …
## $ admrate   &lt;dbl&gt; 0.9175, 0.7366, 0.8257, 0.9690, 0.8268, 0.9044, 0.8067, 0.53…
## $ satavg    &lt;dbl&gt; 939, 1234, 1319, 946, 1261, 1082, 1300, 1230, 1066, NA, 1076…
## $ cost      &lt;dbl&gt; 23053, 24495, 23917, 21866, 29872, 19849, 31590, 32095, 3431…
## $ netcost   &lt;dbl&gt; 14990, 16953, 15860, 13650, 22597, 13987, 24104, 22107, 2071…
## $ avgfacsal &lt;dbl&gt; 69381, 99441, 87192, 64989, 92619, 71343, 96642, 56646, 5400…
## $ pctpell   &lt;dbl&gt; 0.7019, 0.3512, 0.2536, 0.7627, 0.1772, 0.4644, 0.1455, 0.23…
## $ comprate  &lt;dbl&gt; 0.2974, 0.6340, 0.5768, 0.3276, 0.7110, 0.3401, 0.7911, 0.69…
## $ firstgen  &lt;dbl&gt; 0.3658281, 0.3412237, 0.3101322, 0.3434343, 0.2257127, 0.381…
## $ debt      &lt;dbl&gt; 15250, 15085, 14000, 17500, 17671, 12000, 17500, 16000, 1425…
## $ locale    &lt;fct&gt; City, City, City, City, City, City, City, City, City, Suburb…
```

---

### Types of Visualizations and Best Graph Types 

Do I want to represent variations within...
* Single variable
* Two variables
* Three variables 

Is or are my variables...
* Continuous
* Categorical
* Other types (discrete, ordinal, nominal, etc.)

---

### Types of Visualizations and Best Graph Types 

**Single variable (Univariate Analysis) to display how values within a single variable vary**
  
* One continuous variable: histogram
* One categorical variable: bar plot

**Two variables (Bivariate Analysis) to display how they co-vary** 

* Two continuous variables: scatter plot
* Two categorical variables: (grouped or stacked) bar plot; dot or mosaic plot
* One categorical and one continuous variable: box plot; faceted histogram

**Three variables (Multivariate Analysis)**

* One categorical and two continuous variables: faceted scatterplot; scatterplot with colors 
* One continuous and two categorical variables: box plot grouped by categorical variables

&lt;!-- *We are going review all plots in bold today, both code and interpretation. The plots listed in this slide are the most common options, but there are more possibilities to explore.* 

*Takeaways: experiment and match the type of plot with the variable types!*
--&gt;

---

## Practice!

In small groups, use the `scorecard` dataset (refer to the code on previous slides to load it) to create the most suitable graph for each task. We’ll then regroup, and I’ll invite each group to share their graphs and code.
* Before plotting: ask yourself "What type of variable is this? What type of variation do I need to represent?" 
* To plot: Use simple code as you would to for your initial EDA analysis (e.g., no need to add titles, axis labels, etc. but you want to add them for your HW assigments!)
* After plotting: stare at the graph (check if there are patterns, outliers, etc.) and interpret it


TASK 1: Display the annual total cost of school attendance across the U.S.

TASK 2: Display the total number of schools in the U.S. by school type


&lt;!--



count: false
 
### 1. One continuous variable: **histogram**
.panel1-histogram-auto[

```r
*ggplot(data = scorecard,
* mapping = aes(x = cost))
```
]
 
.panel2-histogram-auto[
&lt;img src="index_files/figure-html/histogram_auto_01_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
count: false
 
### 1. One continuous variable: **histogram**
.panel1-histogram-auto[

```r
ggplot(data = scorecard,
  mapping = aes(x = cost)) +
* geom_histogram()
```
]
 
.panel2-histogram-auto[
&lt;img src="index_files/figure-html/histogram_auto_02_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

&lt;style&gt;
.panel1-histogram-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-histogram-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-histogram-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



HISTOGRAM: for **continuous variables** (here `cost`). It splits the input variable into n sets of equal width and does a frequency count within each set.

--

*Interpretation: What does this histogram tell us? Distribution? Picks?* 
*Code: What are some alternative ways to rewrite this code (using what we know) to get the same plot?*

&lt;!-- see the file called "histogram_otherway_tocode.Rmd" and do this in class or put it back in slides --&gt;

---



count: false
 
### Bins in histograms
.panel1-histogram-bins-rotate[

```r
ggplot(
  data = scorecard,
  mapping = aes(x = cost)
) +
* geom_histogram(bins = 50)
```
]
 
.panel2-histogram-bins-rotate[
&lt;img src="index_files/figure-html/histogram-bins_rotate_01_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
count: false
 
### Bins in histograms
.panel1-histogram-bins-rotate[

```r
ggplot(
  data = scorecard,
  mapping = aes(x = cost)
) +
* geom_histogram(bins = 30)
```
]
 
.panel2-histogram-bins-rotate[
&lt;img src="index_files/figure-html/histogram-bins_rotate_02_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
count: false
 
### Bins in histograms
.panel1-histogram-bins-rotate[

```r
ggplot(
  data = scorecard,
  mapping = aes(x = cost)
) +
* geom_histogram(bins = 10)
```
]
 
.panel2-histogram-bins-rotate[
&lt;img src="index_files/figure-html/histogram-bins_rotate_03_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

&lt;style&gt;
.panel1-histogram-bins-rotate {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-histogram-bins-rotate {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-histogram-bins-rotate {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



Bins: each bar is a bin and represents one interval or set of data. In these examples, we divided the data into 50, 30 (default), or 10 `bins` of equally sized bars. 

Instead than `bins` you can also use `binwidth`, which changes the width of each bin vs. their number (see [here](https://r-charts.com/distribution/histogram-binwidth-ggplot2/))

---

### 2. One categorical variable: **bar chart**

TASK 2: Use the `scorecard` data to show the schools in the U.S. by school type

For representing one categorical variable (here `type`): the best graph is usually a bar chart.

&lt;!-- code this in class, without asking students to help,  before start typing: go back to previous slide and copy code to load library, etc. --&gt;

---



count: false
 
### 2. One categorical variable: bar chart
.panel1-barplot-auto[

```r
*ggplot(
* data = scorecard,
* mapping = aes(x = type)
*) 
```
]
 
.panel2-barplot-auto[
&lt;img src="index_files/figure-html/barplot_auto_01_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
count: false
 
### 2. One categorical variable: bar chart
.panel1-barplot-auto[

```r
ggplot(
  data = scorecard,
  mapping = aes(x = type)
) +
* geom_bar()
```
]
 
.panel2-barplot-auto[
&lt;img src="index_files/figure-html/barplot_auto_02_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

&lt;style&gt;
.panel1-barplot-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-barplot-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-barplot-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



BAR CHART: for **categorical variables** (here `type`). It takes each category of the variable (here `"Public"`, `"Private nonprofit"`, `"Private for profit"`) and automatically applies a frequency count to aggregate the data by these categories. 

--

*Like we did for the histogram, let's focus on both interpretation and code: What does this graph show?*

&lt;!-- we have already seen how a code similar to this, the previous one, can be rewritten. So let's focus on something new about code: the default statistics for bar chart and why this matter --&gt; 

---

### Bar chart and its default stats

The default statistic for `geom_bar()` is `count`, not `identity` ([documentation](https://ggplot2.tidyverse.org/reference/geom_bar.html)).

This means two things:
* `geom_bar()` automatically counts the number of occurrences for each category on the x variable
* and, when using `stat = "count"`, you do not need to provide a y variable: `geom_bar()` calculates the counts for you and displays them on the y axis

---

### Bar chart and its default stats

In practice, under the hood `geom_bar()` does the equivalent of the following `dplyr` code:


```r
scorecard %&gt;%
  count(type)
```

```
## # A tibble: 3 × 2
##   type                    n
##   &lt;fct&gt;               &lt;int&gt;
## 1 Public                536
## 2 Private, nonprofit   1110
## 3 Private, for-profit    86
```

--

We can explicitly instruct `geom_bar()` not to perform the count, by setting `geom_bar(stats = "identity")`. In this case, we need to explicitly provide a y variable with the frequency count (e.g., the `n` column in the example above).

*But why would we want to do this?  For example, to reorder the bars!*

---

### Reorder bar chart levels

.panelset[
.panel[.panel-name[Not Ordered]


&lt;img src="index_files/figure-html/not-ordered-1.png" width="80%" style="display: block; margin: auto;" /&gt;

]

.panel[.panel-name[Ordered]

&lt;img src="index_files/figure-html/reordered-1.png" width="80%" style="display: block; margin: auto;" /&gt;

]
]

---

### Reorder bar chart levels (base approach)

Reorder the levels of a categorical variable with `dplyr` and `ggplot` combined:


```
# calculate count for variable of interest and save in new dataframe
count_type &lt;- scorecard %&gt;%
  count(type)

# use the new dataframe to create the graph
ggplot(count_type,
       mapping = aes(x = reorder(type, desc(n)), 
                     y = n)) +
       geom_bar(stat = "identity")
```

--

```
# alternative equivalent code
scorecard %&gt;%
  count(type) %&gt;%
  ggplot(mapping = aes(x = reorder(type, desc(n)), 
                       y = n)) +
  geom_bar(stat = "identity")
```


---

### Reorder bar chart levels (other approaches)

[`fct_relevel()`](https://forcats.tidyverse.org/reference/fct_relevel.html): allows to reorder factor levels by hand

```
scorecard %&gt;%
  mutate(
  type = fct_relevel(.f = type, 
                    levels = "Private, nonprofit", "Public", "Private, for-profit" )) %&gt;%
  ggplot(
    mapping = aes(x = type)) +
    geom_bar()
```

[`fct_infreq()`](https://forcats.tidyverse.org/reference/fct_inorder.html): reorders factor levels by the number of obs. with each level (frequency)

```
scorecard %&gt;%
  mutate(type = fct_infreq(type)) %&gt;%
  ggplot(
    mapping = aes(x = type)) +
  geom_bar()
```

---

class: inverse, middle

## COVARIATION or bivariate analysis

We talk about the following examples (in bold):

1. Two continuous variables: **scatter plot**
2. Two categorical variables: **bar chart**; pie chart; dot plot; mosaic plot
3. One categorical and one continuous variable: **box plot**; **faceted histogram**
4. One categorical and two continuous variables (multivariate analysis): **faceted scatterplot**

---

### 1. Two continuous variables: **scatter plot**

TASK: Show the annual total cost and net cost of attendance to schools in the U.S. 

For representing two continuous variables (here `cost` and `netcost`): the best graph is usually a scatter plot.

&lt;!-- code this in class, without asking students to help,  before start typing: go back to previous slide and copy code to load library, etc. --&gt;

---



count: false
 
### 1. Two continuous variables: **scatter plot**
.panel1-scatterplot-auto[

```r
*ggplot(
* data = scorecard,
* mapping = aes(
*   x = cost,
*   y = netcost
* )
*) 
```
]
 
.panel2-scatterplot-auto[
&lt;img src="index_files/figure-html/scatterplot_auto_01_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
count: false
 
### 1. Two continuous variables: **scatter plot**
.panel1-scatterplot-auto[

```r
ggplot(
  data = scorecard,
  mapping = aes(
    x = cost,
    y = netcost
  )
) +
* geom_point()
```
]
 
.panel2-scatterplot-auto[
&lt;img src="index_files/figure-html/scatterplot_auto_02_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

&lt;style&gt;
.panel1-scatterplot-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-scatterplot-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-scatterplot-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



SCATTERPLOT: looks at the relationship between two **continuous variables** (here `cost` and `netcost`). Each point represents an observation. The position of a point on the x-axis corresponds to one variable, while the position on y-axis corresponds to the other variable.

--

*What does this scatter plot tell us? What about the points not clearly aligned? What further EDA could we perform starting from this plot?*

&lt;!--

As the advertised price increases, the net cost also increases though with significant variations. Some schools have a much lower net cost than their advertised price.

No clear alignment on diagonal, net costs tend to be lower than advertised costs for several schools, especially as the adv costs increase; in most universities the average student pay less than the adv costs. Notice this is a 2d plot bcs we are mapping two variables: one on the y and one on the x.

Link to next slide: for histogram does not make sense to map a second variable on the y, beside count/frequency bcs with a histogram see the total distribution (vs box plot in which you see summary stats of the distribution). 
--&gt;

---

### 2. Two categorical variables: **bar chart**

TASK: Show the total number of schools in the U.S. by school type (n = 3) and by state (n = 54)

For representing two categorical variables (here `type` and `state` ) the most appropriate graph is usually a (stacked) bar chart.

---



count: false
 
### 2. Two categorical variables: **bar chart**
.panel1-barplot_cat-auto[

```r
*ggplot(
* data = scorecard,
* mapping = aes(
*   x = type,
*   fill = state,
* )
*) 
```
]
 
.panel2-barplot_cat-auto[
&lt;img src="index_files/figure-html/barplot_cat_auto_01_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
count: false
 
### 2. Two categorical variables: **bar chart**
.panel1-barplot_cat-auto[

```r
ggplot(
  data = scorecard,
  mapping = aes(
    x = type,
    fill = state,
  )
) +
* geom_bar(position = "stack")
```
]
 
.panel2-barplot_cat-auto[
&lt;img src="index_files/figure-html/barplot_cat_auto_02_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

&lt;style&gt;
.panel1-barplot_cat-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-barplot_cat-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-barplot_cat-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



STACKED BAR CHART: Each bar represents one category of a categorical variable, and is divided into segments representing the categories of the other categorical variable.

*But... is this a good graph? Why or why not? How can we improve it? Is the issue with the graph type or the data?*

&lt;!-- code this in class, without asking students to help,  before start typing: go back to previous slide and copy code to load library, etc.  why not y? it is a bar chart (y is the frequency count of categories of x) --&gt;

---

### 3. (a) One categorical and one continuous: **box plot**

TASK: Show the total annual cost of attendance by school type (n = 3).

For representing one continuous variable (here `cost`) and a one categorical variable (here `type`), the best graph is a usually a box plot.

&lt;!-- code this in class, without asking students to help,  before start typing: go back to previous slide and copy code to load library, etc. --&gt;

---



count: false
 
### 3. (a) One categorical and one continuous: **box plot**
.panel1-boxplot-auto[

```r
*ggplot(
* data = scorecard,
* mapping = aes(
*   x = type,
*   y = cost
* )
*) 
```
]
 
.panel2-boxplot-auto[
&lt;img src="index_files/figure-html/boxplot_auto_01_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
count: false
 
### 3. (a) One categorical and one continuous: **box plot**
.panel1-boxplot-auto[

```r
ggplot(
  data = scorecard,
  mapping = aes(
    x = type,
    y = cost
  )
) +
* geom_boxplot()
```
]
 
.panel2-boxplot-auto[
&lt;img src="index_files/figure-html/boxplot_auto_02_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

&lt;style&gt;
.panel1-boxplot-auto {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-boxplot-auto {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-boxplot-auto {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



BOX PLOT: looks at the relationship between a continuous variable (here `cost`) and a  categorical variable (here `type`). It summarizes the continuous variable distribution across each of the categorical variables.

--

*What does this box plot tell us? How do we read a box plot?*

&lt;!-- median is the line in the middle, the middle value 
Here we see that on average, public universities are the least expensive, followed by private for-profit institutions. I was somewhat surprised by this since for-profit institutions by definition seek to generate a profit, so wouldn't they be the most expensive? But perhaps this makes sense, because they have to attract students so need to offer a better financial value than competing nonprofit or public institutions. Is there a better explanation for these differences? Another question you could explore after viewing this visualization.
--&gt;

---

### Box plot

&lt;img src="https://d33wubrfki0l68.cloudfront.net/153b9af53b33918353fda9b691ded68cd7f62f51/5b616/images/eda-boxplot.png" width="80%" style="display: block; margin: auto;" /&gt;

.footnote[Source of image: "R for Data Science" 1st Ed. Chapter 7]

---

### 3. (b) One categorical and one continuous: **faceted histogram**

TASK: Show the total annual cost of attendance by school type (n = 3)

Other than using a box plot, we can represent this same task using a faceted histogram, which creates multiple windows: one for each level of the categorical variable.

---



count: false
 
### 3. (b) One categorical and one continuous: **faceted histogram**
.panel1-histogram-facet-user[

```r
*ggplot(
* data = scorecard,
* mapping = aes(x = cost)
*) +
* geom_histogram()
```
]
 
.panel2-histogram-facet-user[
&lt;img src="index_files/figure-html/histogram-facet_user_01_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
count: false
 
### 3. (b) One categorical and one continuous: **faceted histogram**
.panel1-histogram-facet-user[

```r
ggplot(
  data = scorecard,
  mapping = aes(x = cost)
) +
  geom_histogram() +
* facet_wrap(facets = vars(type))
```
]
 
.panel2-histogram-facet-user[
&lt;img src="index_files/figure-html/histogram-facet_user_02_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

&lt;style&gt;
.panel1-histogram-facet-user {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-histogram-facet-user {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-histogram-facet-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



FACETED HISTOGRAM: looks at the distribution of a continuous variable (here `cost`) across different levels of the categorical variable (here `type`). The y-axis shows frequency count for each level of the categorical variable. Histograms cannot map a second variable directly, but we can use facets to compare the distribution of each college type. 

*Compare this with box plot. Which one do you prefer and why?*

---

### 4. Three variables: **faceted scatterplot** 

TASK: Show the total annual cost of attendance and the net cost of attendance, by school type (n = 3).

This last example shows how to plot three variables at the same time on the same graph, using a faceted scatterplot. 

---



count: false
 
### 4. Three variables: **faceted scatterplot**
.panel1-scatterplot-facet-user[

```r
*ggplot(
* data = scorecard,
* mapping = aes(
*   x = cost,
*   y = netcost
* )
*) +
* geom_point()
```
]
 
.panel2-scatterplot-facet-user[
&lt;img src="index_files/figure-html/scatterplot-facet_user_01_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
count: false
 
### 4. Three variables: **faceted scatterplot**
.panel1-scatterplot-facet-user[

```r
ggplot(
  data = scorecard,
  mapping = aes(
    x = cost,
    y = netcost
  )
) +
  geom_point() +
* facet_wrap(facets = vars(type))
```
]
 
.panel2-scatterplot-facet-user[
&lt;img src="index_files/figure-html/scatterplot-facet_user_02_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

&lt;style&gt;
.panel1-scatterplot-facet-user {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-scatterplot-facet-user {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-scatterplot-facet-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



SCATTERPLOT WITH FACETS: looks at two  continuous variables (here `cost` and `netcost`) for several levels of a categorical variable (here `types` of school), and plots each in a separate panel with the same scale range on the x and y.

---



count: false
 
### Utilizing additional aesthetics
.panel1-scatterplot-mult-channels-rotate[

```r
ggplot(
  data = scorecard,
  mapping = aes(
    x = cost,
    y = netcost,
*   color = type,
  )
) +
  geom_point()
```
]
 
.panel2-scatterplot-mult-channels-rotate[
&lt;img src="index_files/figure-html/scatterplot-mult-channels_rotate_01_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---
count: false
 
### Utilizing additional aesthetics
.panel1-scatterplot-mult-channels-rotate[

```r
ggplot(
  data = scorecard,
  mapping = aes(
    x = cost,
    y = netcost,
*   color = type, size = debt
  )
) +
  geom_point()
```
]
 
.panel2-scatterplot-mult-channels-rotate[
&lt;img src="index_files/figure-html/scatterplot-mult-channels_rotate_02_output-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

&lt;style&gt;
.panel1-scatterplot-mult-channels-rotate {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 60%
}
.panel2-scatterplot-mult-channels-rotate {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 60%
}
.panel3-scatterplot-mult-channels-rotate {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 60%
}
&lt;/style&gt;



Rather than using facets (for school type), we could use the color aesthetic to incorporate the `type` info into the same visualization. We can even add a fourth variable such as `depth` and render it through the `size` aesthetic. *BUT does this make the graph more informative?* Not really... Visualizations need to be clear and aesthetically pleasing, here it would be better to split the plot into two separate ones!

&lt;!-- for in-class activity add task with this scorecard data that requires examining two categorical var and one continious one: grouped bar plot, heatmap, facet grid --&gt; 

---

### Other types of graphs

Today we examined the most common graph options, but there are many other options you can experiment with.

See the Visualization cheat sheet: 

* Help &gt; Cheat Sheets &gt; Data Visualization with ggplot2

* Note there are several **cheat sheets** for tidyverse and R: https://posit.co/resources/cheatsheets/

---

class: inverse, middle

# Factors

Brief introduction to factors (since we talked about categorical variables). We will come back to factors later in the course. 

---

Takeaway: **Categorical variables**, also called discrete variables are variables with a fixed set of possible values. R uses **factors** to work with these variables.

Chapter 16 of "R for Data Science" (2nd Ed.) explains how to create and work with factors: 


```r
month_string &lt;- c(
  "Jan", "Feb", "Mar", "Apr", "May", "Jun", 
  "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
)
month_string
class(month_string)   # character
```


```r
month_factor &lt;- factor(month_string, levels = month_string)
month_factor
class(month_factor)   # factor
```

Notice `class` is the attribute of the object (VS `typeof`: R internal storage of the object).

---

class: inverse, middle

# Practice exploring data

Download today's class materials from the website! 

&lt;!--
## Acknowledgments 

The content of these slides is derived in part from Benjamin Soltoff’s “Computing for the Social Sciences” course materials, licensed under the CC BY NC 4.0 Creative Commons License. Any errors or oversights are mine alone.
--&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "magula",
"highlightLines": true,
"highlightLanguage": "r",
"ratio": "16:9",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
